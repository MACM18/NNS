# NNS Telecom Management System - Copilot Instructions

## Project Overview

NNS is a comprehensive telecom management system built with Next.js for managing fiber optic line installations, inventory, and operational tasks. The system handles the complete lifecycle of telecom installations from task assignment to completion verification.

### Core Business Domain

This application manages:
- **Fiber Optic Line Installations**: Complete workflow from planning to completion
- **Distribution Points (DPs)**: Network infrastructure endpoints with specific naming conventions
- **Inventory Management**: Tracking of cables, hardware components, and installation materials
- **Task Management**: Assignment, tracking, and completion of installation tasks
- **AI-Powered Suggestions**: Automated error detection and process optimization

## Technology Stack

- **Frontend**: Next.js 15 with React 19, TypeScript
- **Styling**: Tailwind CSS with Radix UI components
- **Backend**: Supabase (PostgreSQL with real-time features)
- **State Management**: React Context API
- **Forms**: React Hook Form with Zod validation
- **Icons**: Lucide React
- **Package Manager**: npm (install with `--legacy-peer-deps` due to React 19 compatibility)

## Development Setup

```bash
# Install dependencies
npm install --legacy-peer-deps

# Development server
npm run dev

# Build for production
npm run build

# Start production server
npm start

# Linting
npm run lint
```

### Environment Variables Required

Create a `.env.local` file in the root directory:
```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

**Note**: The build will fail without these environment variables as Supabase client initialization is required during the build process.

## Architecture & File Structure

```
├── app/                    # Next.js App Router pages
│   ├── auth/              # Authentication pages
│   ├── inventory/         # Inventory management
│   ├── invoices/          # Invoice generation
│   ├── tasks/             # Task management
│   ├── reports/           # Reporting system
│   └── profile/           # User profile
├── components/            # Reusable UI components
│   ├── auth/              # Authentication components
│   ├── layout/            # Layout components (sidebar, header)
│   ├── modals/            # Modal dialogs
│   ├── tables/            # Data tables
│   └── ui/                # Base UI components (shadcn/ui)
├── contexts/              # React Context providers
├── hooks/                 # Custom React hooks
├── lib/                   # Utility libraries
└── styles/                # Global styles
```

## Key Domain Concepts

### Distribution Points (DPs)
- **Format**: `XX-XXXX-XXXX-XXX-0X` (e.g., "ABC-MAIN-1234-001-01")
- **Components**: 
  - Area code (1-4 letters)
  - Location identifier (1-4 letters)
  - Numeric identifier (4 digits)
  - Sub-identifier (3 digits)
  - Port number (01-08)
- **Validation**: Regex pattern enforced in forms and AI suggestions

### Cable Measurements
- **F1**: Distance between cable start and middle points
- **G1**: Distance between cable middle and end points
- **Total Cable**: Sum of F1 + G1 calculations
- **Wastage**: Additional cable used, should not exceed 20% of total

### Power Readings
- **Power DP**: Signal strength at distribution point
- **Power Inbox**: Signal strength at customer premises
- **Thresholds**: Values >= 20 trigger high power warnings

### Inventory Items
Common tracked items include:
- **Rosettes**: Fiber (fiber_rosette) and Standard (s_rosette)
- **Hardware**: Hooks (l_hook, c_hook), bolts, clips, ties
- **Cables**: Various types with length measurements
- **Installation Materials**: Conduits, casings, poles

## Component Patterns

### Modal Components
All modals follow this pattern:
```tsx
interface ModalProps {
  open: boolean
  onOpenChange: (open: boolean) => void
  onSuccess?: () => void
}

export function MyModal({ open, onOpenChange, onSuccess }: ModalProps) {
  // Form state management
  // Validation logic
  // Supabase operations
  // Notification handling
}
```

### Form Validation
- Use React Hook Form with Zod schemas
- Implement real-time validation for critical fields (DP format, serials)
- Show validation errors with clear messaging

### Data Tables
- Use custom table components with sorting/filtering
- Implement pagination for large datasets
- Include action columns for CRUD operations

## Database Integration

### Supabase Client Usage
```tsx
import { getSupabaseClient } from "@/lib/supabase"

const supabase = getSupabaseClient()

// Query example
const { data, error } = await supabase
  .from("line_details")
  .select("*")
  .eq("status", "active")
```

### Key Tables
- **line_details**: Core line installation data with measurements and inventory
- **tasks**: Task management and workflow status tracking  
- **inventory_items**: Material and component tracking
- **drum_tracking**: Cable drum inventory with current quantities
- **invoices**: Billing and invoice generation
- **profiles**: User profile information linked to auth users

### Business Rules Enforced
- Tasks cannot be completed without corresponding line_details
- DP format must follow strict pattern: `^[A-Z]{1,4}-[A-Z]{1,4}-\\d{4}-\\d{3}-0[1-8]$`
- Cable wastage should not exceed 20% of total cable length
- Drum quantities must be sufficient for cable requirements
- Power readings >= 20 trigger warnings for quality checks
- Serial numbers (ONT, STB) must be valid hexadecimal format

## AI Features

### Error Detection
The AI service automatically detects:
- High power readings (>= 20)
- Excessive wastage (> 20% of total cable)
- Invalid DP formats
- Missing phone numbers

### DP Suggestions
- Analyzes existing DP patterns
- Suggests next available DP numbers
- Considers frequency and location patterns

### Implementation
```tsx
import { AIService } from "@/lib/ai-suggestions"

const aiService = new AIService()
const suggestions = await aiService.getDPSuggestions(partialDP)
```

## Common Workflows

### Adding a New Line Installation
1. Create task via Add Task Modal
2. Fill line details with measurements
3. Select appropriate drum/inventory
4. Validate DP uniqueness
5. Complete installation
6. Mark task as completed (requires line details)

### Inventory Management
1. Track drum quantities and usage
2. Update inventory after installations
3. Generate reports for restocking
4. Monitor wastage and efficiency

### Invoice Generation
1. Collect completed line installations
2. Calculate material costs and labor
3. Generate monthly invoices
4. Export to external systems

## Best Practices

### Code Style
- Use TypeScript strict mode
- Follow Next.js app router conventions
- Implement proper error boundaries
- Use semantic HTML and ARIA labels

### Performance
- Use React.memo for expensive components
- Implement proper loading states
- Optimize database queries with proper indexes
- Use Next.js Image component for optimizations

### Security
- Validate all inputs on both client and server
- Use Supabase RLS (Row Level Security) policies
- Sanitize user data before database operations
- Implement proper authentication checks

### Testing Considerations
- Test form validation logic
- Verify DP format validation
- Test calculation accuracy (F1, G1, total)
- Validate AI suggestion algorithms
- Test task workflow completion

## Common Issues & Solutions

### Dependencies
- Use `npm install --legacy-peer-deps` due to React 19 compatibility
- Some peer dependency warnings are expected

### Build Configuration
- TypeScript and ESLint errors are ignored during builds (see next.config.mjs)
- Images are unoptimized for static exports
- **Requires Supabase environment variables** - build will fail without proper .env.local configuration

### ESLint Setup
- If ESLint is not configured, run: `npm install --legacy-peer-deps eslint eslint-config-next --save-dev`
- Create `.eslintrc.json` with basic Next.js configuration

### DP Validation
- Ensure DP format matches exact regex pattern
- Check for uniqueness across entire system
- Handle edge cases in partial matching

## Development Tips

### When adding new features:
1. Follow existing modal/form patterns
2. Add proper TypeScript interfaces
3. Implement loading and error states
4. Add AI validation where appropriate
5. Update inventory calculations if needed

### When modifying calculations:
1. Verify F1/G1 math is correct
2. Update wastage percentage checks
3. Test with various cable measurements
4. Ensure drum quantity updates properly

### When working with Supabase:
1. Use the singleton client pattern
2. Handle errors gracefully
3. Implement proper loading states
4. Consider real-time subscriptions for live data

This system is designed for telecom professionals managing fiber optic installations. Understanding the domain terminology and workflow is crucial for effective development.